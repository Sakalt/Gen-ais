<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ハイドロAI</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/brain.js/1.6.1/brain.min.js"></script>
</head>
<body>
    <h1>ハイドロAI</h1>
    <textarea id="input" placeholder="メッセージを入力"></textarea>
    <button id="run">送信</button>

    <h2>カスタムデータの追加</h2>
    <textarea id="customInput" placeholder="カスタムデータを入力"></textarea>
    <button id="addCustom">カスタムデータを追加</button>

    <h2>出力:</h2>
    <pre id="output"></pre>

    <script>
        let trainingData = [];
        const net = new brain.recurrent.LSTM();

        // JSONデータの読み込み
        fetch('data/X.json')
            .then(response => response.json())
            .then(data => {
                trainingData = data.conversations;
                initializeModel(trainingData);
            });

        const initializeModel = (conversations) => {
            net.train(conversations.map(item => ({
                input: item.input,
                output: item.input,
                要求: item.要求
            })), {
                iterations: 2000,
                log: true,
                logPeriod: 100,
            });
        };

        // 天気情報を取得
        const fetchWeather = async (location) => {
            const response = await fetch(`https://wttr.in/${location}?format=%C+%t`);
            const weather = await response.text();
            return weather;
        };

        // 応答生成
        const generateResponse = async (input) => {
            if (input.includes('天気は') || input.includes('天気')) {
                const location = input.match(/(東京|大阪|名古屋|福岡|札幌)/);
                if (location) {
                    const weather = await fetchWeather(location[0]);
                    return `現在の${location[0]}の天気: ${weather}`;
                }
                return "天気の場所が指定されていません。";
            }
            const response = net.run(input);
            return response || "申し訳ありませんが、その質問にはお答えできません。";
        };

        // ボタンクリック時の処理
        document.getElementById('run').addEventListener('click', async () => {
            const userInput = document.getElementById('input').value;
            const response = await generateResponse(userInput);
            document.getElementById('output').textContent = `ユーザー: ${userInput}\nAI: ${response}`;
        });

        // カスタムデータを追加
        document.getElementById('addCustom').addEventListener('click', () => {
            const customInput = document.getElementById('customInput').value;
            if (customInput) {
                // カスタムデータをモデルに追加
                net.train([{ input: customInput, output: customInput }], {
                    iterations: 200,
                    log: false,
                });
                alert('カスタムデータを追加しました！');
                document.getElementById('customInput').value = '';
            }
        });
    </script>
</body>
</html>
